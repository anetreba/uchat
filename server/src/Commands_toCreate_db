sqlite3 server.db

CREATE TABLE Users(
    id          INTEGER        NOT NULL       PRIMARY KEY AUTOINCREMENT,
    login       VARCHAR(25)    NOT NULL,
    pass        VARCHAR(255)   NOT NULL,
    nick        VARCHAR(255)   NOT NULL,
    last_online TIMESTAMP,
    auth_token  VARCHAR(255),
    token_aval  TIMESTAMP
);

CREATE TABLE Userdata (
    id          INTEGER        NOT NULL       PRIMARY KEY AUTOINCREMENT,
    user_id     INTEGER        NOT NULL,
    first_name  VARCHAR(255),
    second_name VARCHAR(255),
    city        VARCHAR(50),
    country     VARCHAR(50),
    );

CREATE TABLE Messages(
    id                  INTEGER     NOT NULL       PRIMARY KEY AUTOINCREMENT,
    message             TEXT        NOT NULL,
    sender_id           INTEGER     NOT NULL,
    room_id             INTEGER,
    recieve_status      INTEGER,
    attaches            INTEGER,
    date_send           TIMESTAMP   NOT NULL
);

CREATE TABLE Rooms(
    id                  INTEGER     NOT NULL       PRIMARY KEY AUTOINCREMENT,
    room_name           TEXT,
    members             TEXT        NOT NULL
);

INSERT INTO Rooms VALUES(1, 'Friends', '1,2,3');
INSERT INTO Rooms VALUES(2, 'Friends', '2,3');
INSERT INTO Rooms VALUES(3, 'Friends', '1,3');

INSERT INTO Messages VALUES(1, 'Hi! ma friend!', 2, 2, 0, 0);
INSERT INTO Messages VALUES(2, 'Hi!', 3, 2, 0, 0);
INSERT INTO Messages(message, sender_id, room_id, recieve_status, ataches) VALUES ('How are U, dude?', 2, 2, 0, 0);





SELECT message FROM Messages INNER JOIN Rooms ON Rooms.id = room_id;


SELECT
    Messages.message as message,
    Messages.sender_id as sender_id,
    Rooms.room_name as room_name
FROM Messages
         LEFT JOIN
     Rooms ON Messages.room_id = Rooms.id
WHERE
        room_id = (SELECT room_id
                   FROM Messages
                   WHERE sender_id = (SELECT id
                                    FROM Users
                                    WHERE auth_token = 'djbEHKvrLK5t5pJqPyehHGCc')
                   group by room_id)